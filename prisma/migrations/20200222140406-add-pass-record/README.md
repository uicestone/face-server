# Migration `20200222140406-add-pass-record`

This migration has been generated by koishi at 2/22/2020, 2:04:06 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Directions" AS ENUM ('IN', 'OUT');

CREATE TABLE "public"."PassRecord" (
    "allow" boolean  NOT NULL DEFAULT false,
    "community" text  NOT NULL ,
    "date" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "direction" "Directions" NOT NULL DEFAULT 'IN',
    "id" text  NOT NULL ,
    "resident" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."User" DROP CONSTRAINT IF EXiSTS "User_plot_fkey",
DROP COLUMN "plot",
ADD COLUMN "community" text   ;

ALTER TABLE "public"."PassRecord" ADD FOREIGN KEY ("community")REFERENCES "public"."Community"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."PassRecord" ADD FOREIGN KEY ("resident")REFERENCES "public"."Resident"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("community")REFERENCES "public"."Community"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200222131154-user-plot----user-community..20200222140406-add-pass-record
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = "postgres://face:1000+faces@stirad.com:8432/face"
 }
 generator client {
   provider = "prisma-client-js"
@@ -41,8 +41,12 @@
 enum AwareLevels {
   BLUE GREEN YELLOW RED
 }
+enum Directions {
+  IN OUT
+}
+
 model Resident {
   id        String      @id
   level     AwareLevels
   name      String
@@ -50,8 +54,17 @@
   unit      Unit
   community Community
 }
+model PassRecord {
+  id        String     @default(cuid()) @id
+  resident  Resident
+  date      DateTime
+  direction Directions
+  allow     Boolean
+  community Community
+}
+
 model Unit {
   id        String     @default(cuid()) @id
   community Community
   building  String
```


